\documentclass[a4paper]{article}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage[lmargin=30mm,rmargin=20mm]{geometry}

\author{Воронин Святослав Петрович}
\title{Использование vim-latex}

\begin{document}
\maketitle
\tableofcontents

\part{Введение}
Мы уже согласились, что для подготовки текстовых документов очень правильно
использовать что-то типа \TeX{} или \LaTeX. Держать в голове все многообразие
команд и окружений, используемых в \LaTeX, и помнить их синтаксис вряд ли представляется возможным.
Помочь в создании исходного текста для последующей обработки его 
\LaTeXом и имеет целью рассматриваемое далее расширение редактора \texttt{Vim}, которое, в дальнейшем,
будем называть \texttt{latexsuite}.
\part{Установка vim-latex}\label{part:install}
Рассмотрим три способа установки рассматриваемого в статье плагина.
\section{Установка с помощью пакетного менеджера.}
Этот метод установки в системах Linux следует считать предпочтительным. При этом, плагин устанавливается
в многопользовательском режиме. То есть, он становится доступным для всех пользователей системы.
Пакеты, которые в необходимо установить, называются: \texttt{vim-latex} и \texttt{vim-latex-doc}.
\section{Установка с помощью менеджера плагинов.}
Для установки плагина будем использовать менеджер плагинов \texttt{Vundle}, 
который, кстати говоря, сам является также плагином \texttt{Vim}.

Для начала нужно установить сам менеджер пакетов. Установка заключается в
клонировании репозитория \texttt{Vundle}. Сделать это можно с помощью следующей
команды:
\begin{verbatim}
git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
\end{verbatim}
Кроме того, нужно отредактировать файл \texttt{~/.vimrc}, добавив в него следующие
строки:
\begin{verbatim}
set nocompatible              " be iMproved, required
filetype off                  " required

set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()
Plugin 'VundleVim/Vundle.vim'
call vundle#end()            " required
\end{verbatim}
Между строками содержащими \texttt{begin()} и \texttt{end()} можно поместить 
пути к другим плагинам, которые будут использоваться редактором \texttt{vim}. 
Для рассматриваемого плагина это будет следующая строка:
\begin{verbatim}
Plugin 'vim-latex/vim-latex'
\end{verbatim}
После чего в командном режиме выполнить команду \texttt{:PluginInstall}.
\section{Установка <<вручную>>.}
Установить plugin \texttt{vim-latex} можно и вручную. Такое часто необходимо, 
если компьютер не подключен к сети. Для этого нужно скачать архив 
\texttt{latexSuite.zip}, расположенный по 
адресу\linebreak \texttt{http://sourceforge.net/projects/vim-latex/files/},
а и распаковать его в каталог \verb|$HOME/.vim/|. 

Во всех случаях после установки нужно в конфигурационный файл \texttt{vim}
добавить следующие строки:
\begin{verbatim}
" REQUIRED. This makes vim invoke Latex-Suite when you open a tex file.
filetype plugin on

" IMPORTANT: win32 users will need to have 'shellslash' set so that latex
" can be called correctly.
set shellslash

" OPTIONAL: This enables automatic indentation as you type.
filetype indent on

" OPTIONAL: Starting with Vim 7, the filetype of empty .tex files defaults to
" 'plaintex' instead of 'tex', which results in vim-latex not being loaded.
" The following changes the default filetype back to 'tex':
let g:tex_flavor='latex'
\end{verbatim}

Кроме того, ещё нужно обновить справочную службу редактора, чтобы добавить
в нее справочные материалы по \texttt{latexsuite}. Сделать это можно с помощью
команды:
\begin{verbatim}
:helptag<путь к каталогу doc>
\end{verbatim}

Рассмотренным образом \texttt{latexsuite} устанавливается в интересах одного пользователя системы.
Если требуется выполнить установку для всех пользователей системы, то все вышеописанное нужно 
сделать в системном каталоге \texttt{VIM}. В Fedora 38 таким каталогом является
\texttt{/usr/share/vim/vimfiles/}. 
\part{Обзор основных функций.}\label{part:main-functions}
Плагин \texttt{latexsuite} предоставляет множество функций и имеет почти
неограниченные функции настройки, что называется <<под себя>>. Все их
рассмотреть вряд ли представляется возможным. Далее рассмотрим только те,
которыми удобно пользоваться и которые дают возможность реально 
повысить производительность работы с программным пакетом \LaTeX.
Можно выделить следующие основные функции пакета \texttt{latexsuite}:
\begin{itemize}
	\item Вставка команд и окружений \LaTeX;
	\item Свёртывание участков кода;
	\item Встроенные команды для трансляции кода и просмотра результатов;
	\item Автодополнение по устанавливаемому словарю из ключевых слов \LaTeX{};
	\item Справочник по командам \LaTeX{} (доступен через меню Vim в графическом режиме).
\end{itemize}
\part{Тонкая настройка.}\label{part:settings}
Пакет \texttt{latexsuite} позволяет себя очень глубоко настраивать.
Настройке подлежит буквально все. Можно включать или выключать отдельные функции плагина,
можно настраивать вид вставляемых команд и окружения \LaTeX. Настройки делаются путем
присваивания значений переменным, которые определяются данным плагином, или вызовом 
макросов с некоторыми параметрами. Лучше всего, это делать в файле \verb|$VIM/ftplugin/tex.vim|,
который будет выполняться при открытии редактором файла соответствующего типа. 
При этом, в операционных системах Linux, 
чаще всего \verb|\$VIM = \$HOME/.vim|. Важно заметить, что действия, которые определены в
файле \verb|$VIM/ftplugin/tex.vim| выполняются до загрузки плагина, когда макросы и переменные
плагина еще не определены, поэтомы изменение переменной или вызов макросв приводит к ошибке. 
Определять переменные плагина в этом файле можно с помощью операции \verb|let <переменная>=|. 
Для того, чтобы можно было изменять значения переменных, операции изменения нужно определить в файле
\verb|$VIM/after/ftplugin/tex.vim|.\sloppy
Посмотреть значение какой-либо переменной можно с помощью команды командного режима \verb|:echo|. 
Например:
\begin{verbatim}
	:echo g:Tex_PromptedCommands
\end{verbatim}

В этом разделе мы бегло рассмотрим общие настройки пакета, а далее, в соответствующих частях 
рассмотрим как можно настроить отдельные функции пакета.
Для того, чтобы в графической версии Vim присутствовало меню, в конфигурационном файле Vim нужно 
написать следующую команду:
\begin{verbatim}
autocmd FileType tex let &guioptions.="m"
\end{verbatim}
Такую команду можно поместить в файл \verb|$VIM/.vimrc|. Напомним, что \texttt{autocmd} говорит
о том, что данную команду нужно выполнять при открытии файла типа \texttt{tex}. Аналогичную 
функциональность можно получить если в файл \verb|$VIM/ftplugin/tex.vim|, который напомним 
тоже будет выполняться при открытии tex-файла, поместить команду изменения переменной.
\begin{verbatim}
let &guioptions.="m"
\end{verbatim}


\part{Вставка команд и окружений.}\label{part:insert}
Есть несколько способов вставки в редактируемый текст команд и окружений \LaTeX.
\begin{itemize}
	\item\sloppy Использование функциональных клавиш. При нажатии клавиши <F5> в режиме
		вставки, появляется список окружений, которые выбираются с помощью 
		указанных в круглых скобках номеров. Нажатие клавиши <F7> предлагает 
		меню комманд. Вызываемые функциональными клавишами меню настраиваются с
		помощью переменных. Список окружений определяется в переменной \verb|g:Tex_PromptedEnvironments|,
		а список команд, предлагаемых в меню в переменной 
		\verb|g:Tex_PromptedCommands|. 
		Например, мы хотим, чтобы в меню команд была бы команда \verb|\verb|. Нужно её добавить. Сделать
		это можно с помощью команды конкатенации строк. Выполним команду:
		\begin{verbatim}
		let g:Tex_PromptedCommands.=',verb'
		\end{verbatim}
		Аналогичным образом можно изменять любую строковую переменную, в том числе и упоминаемую ранее
		\verb|g:Tex_PromptedEnvironments|.
	\item Если при нажатии клавиши <F7> курсор находится на каком-либо слове, 
		то создается команда, состоящая из этого слова и курсор помещается в
		фигурные скобки, помещаемые после созданной команды. 
	\item Для вставки окружений можно использовать горячие клавиши. Работают они 
		в режиме вставки и вызываются комбинациями клавиш \texttt{<s-F1>} --- \texttt{<s-F4>}.
		Очевидно, что таких окружений может быть не более четырех, и их нужно 
		задать определив переменную \verb|g:Tex_HotKeyMappings|.
	\item Трехбуквенные последовательности. Плагин \texttt{latexsuite} предоставляет
		множество таких последовательносте, которые можно разбить на некоторые классы.
		\begin{itemize}
			\item 
		Так для вставки команд управления шрифтами 
		используются трехбуквенные абревиатуры, начинающиеся с заглавной буквы F, при
		этом две другие буквы эквивалентны названию шрифта из соответсвующей команды 
		\LaTeX. Примеры таких команд представлены в табл.\ref{tab:fonts}.
			\item Для создания окружений используются трехбуквенные команды начинающиеся
				с заглавной буквы E. Например:
			  \begin{itemize}
				  \item \texttt{ECE} создает окружение \verb|center|;
				  \item \texttt{EQE} создает окружение \verb|quote|;
				  \item \texttt{EEQ} создает окружение \verb|equation|;
				  \item \texttt{ETE} создает окружение \verb|table|;
				  \item \texttt{ETR} создает окружение \verb|tabular|.
			  \end{itemize}
			  Полный список трёхбуквенных сокращения для создания окружений можно посмотреть, 
			  выполнив команду <<командного режима>> \verb|:echo environmentshortcuts|.
		  \item Трехбуквенные последовательности, используемые для формирования команд
		секционирования текста начинаются в буквы \texttt{S}. Вот эти команды:
				\begin{itemize}
					\item \texttt{SPA} для \verb|\part|;
					\item \texttt{SCH} для \verb|\chapter|;
					\item \texttt{SSE} для \verb|\section|;
					\item \texttt{SSS} для \verb|\subsection|;
					\item \texttt{SS2} для \verb|\subsubsection|;
					\item \texttt{SPG} для \verb|\paragraph|;
					\item \texttt{SSP} для \verb|\subparagraph|.
				\end{itemize}
		\end{itemize}
		Иногда всё же может потребоваться вставить в текст трехбуквенную абревиатуру, 
		которая не должны заменяться на соответствующую команду \LaTeX. Для этого нужно 
		ввести эту абревиатуру, она заменится на команду, после этого нужно нажать \texttt{u},
		то есть команду выполняющую отмену последнего действия, и в тексте останется 
		введенная абревиатура. 
	\item \texttt{latexsuite} по аналогии с символом \texttt{Leader} определяет
		дополнительный символ \verb|Tex_Leader|(чаще всего используется символ \texttt{`}),
		с участием которого формируется 
		множество новых управляющих последовательностей. Существуют <<синонимы>> трехбуквенных
		последовательностей для вставки в исходный текст \LaTeXовский окружения, использующих
		\verb|Tex_Leader|. Полный список таких <<синонимов>> также доступен по команде
		\verb|:echo environmentshortcuts|. Для вставки в документ
		греческих букв также используются следующие последовательности, содержащие 
		\verb|Tex_Leader|, например:
		\begin{itemize}
			\item \verb|`a| эквивалентно команде \verb|\alpha|, вставляет символ $\alpha$;
			\item \verb|`b| эквивалентно команде \verb|\beta|, вставляет символ $\beta$;
			\item \verb|`G| эквивалентно команде \verb|\Gamma|, которая вставляет символ $\Gamma$.
		\end{itemize}
		Аналогичные команды существуют для всех прописных греческих букв. Заглавные греческие
		буквы не все имеют соответствующую команду в \texttt{latexsuite}.
\end{itemize}
			\begin{table}
				\centering
				\begin{tabular}{|c|c|c|}
					\hline
					команда \LaTeX&3-х буквенный эквивалент&Пример\\
					\hline
					\verb|\textrm|\{\ldots\}&FRM&\textrm{Гарнитура Roman}\\
					\verb|\textsf|\{\ldots\}&FSF&\textsf{Гарнитура Sans-serif}\\
					\verb|\texttt|\{\ldots\}&FTT&\texttt{Гарнитура typewriter}\\
					\verb|\textbf|\{\ldots\}&FBF&\textbf{Полужирный}\\
					\hline
				\end{tabular}
				\caption{Команды управления шрифтами}
				\label{tab:fonts}
			\end{table}
Вы уже заметили, что когда команда \LaTeX{} или окружение вставляется в исходный код документа, 
то вставляются такие значки: \verb|<++>| или даже \verb|<+filename+>|. Эти значки называются 
\texttt{placeholder}, то есть место для вставки. В каких места помещать \texttt{placeholder}
определяется содержимыи переменной \verb|g:Tex_команда|. Между символами \texttt{+} можно поместить
что-нибудь, что будет подсказкой того, что нужно поместить в этом месте вставляемой команды
или окружения. То есть, если мы хотим в качестве шаблона команды \verb|\verb| 
видеть следующее: \verb$\verb||<++>$, то нужно выполнить следующее присваивание:
\begin{verbatim}
	let g:Tex_Com_verb = ''\\verb|<++>|<++>''
\end{verbatim}
При этом курсор будет помещен на первый \texttt{placeholder}, и перемещение по таким 
местам ввода осуществляется с помощью комбинации клавиш \texttt{Ctrl-j}. Данную комбинацию,
кстати, тоже можно переопределить. Для этого в файл \verb|$VIM/after/ftplugin/tex.vim| 
нужно поместить следующую строку:
\begin{verbatim}
imap <C-k> <Plug>IMAP_JumpForward
\end{verbatim}
В результате перемещение по \texttt{placeholder} будет производиться по комбинации \texttt{Ctrl-k}
\part{Свёртывание участков кода.}
			При открытии tex-файла редактором \texttt{VIM} с запущенным \texttt{latexsuite}
			все свёртывания свернуты. Конечно, можно использовать стандартные команды \texttt{VIM}
			для управления свёртываниями. Напомним, это:
			\begin{itemize}
			  \item \texttt{zo} для открытия свёртывания;
			  \item \texttt{zc} для закрытия свёртывания;
			  \item \texttt{za} для переключения состояния свёртывания;
			\end{itemize}
			При этом, если вторая буква команды заглавная, то соответсвующая команда выполняется 
			рекурсивно. 
			Кроме того, \texttt{latexsuite} добавляет еще несколько команд. А именно:
			\begin{itemize}
			  \item \texttt{zR} --- открывает все свёртывания в файле;
			  \item \texttt{<Leader>rf} --- закрывает все свёртывания.
			\end{itemize}

Существует  несколько переменных, с помощью которых задаются правила свертывания исходного текста
создаваемого документа. Окружения, которые будут по умолчанию свернуты задаются в переменной
\verb|g:Tex_FoldedEnvironments|, а сворачиваемые команды описаны в переменно \verb|g:Tex_FoldedCommands|.
Кстати, по умолчанию переменная \verb|g:Tex_FoldedCommands|, являющаяся строковой, пустая.

\part{Трансляция, просмотр и отладка.}
Почти полноценной средой разработки может считаться такой программный продукт, который
имеет функции трансляции, просмотра результата и некоторые инструменты отладки. \texttt{latexsuite} такую возможность
предоставляет. Для компиляции используется команда \texttt{<Leader>ll}, для просмотра -- команда
\texttt{<Leader>lv}. Что здесь нужно настроить? По умолчанию, трансляция исходного документа
производится командой \texttt{latex}, результатом которой является \texttt{dvi-файл}. 
Наверное, это не всегда то, что нужно. Если мы хотим получить в результате транляции
\texttt{pdf-файл}, то нужно в командном режиме \LaTeX{} выполнить, определенный рассматриваемым
расширением, макрос \texttt{TTarget}. То есть нужно выполнить команду \verb|:TTarget| и 
в полученном приглашении ввести \texttt{pdf}. Чтобы не делать это после каждого запуска
\texttt{vim}, нужно в файл \verb|$VIM/after/ftplugin/tex.vim| поместить строку
\begin{verbatim}
TTarget pdf
\end{verbatim}
Кроме того, можно определить программу для просмотра полученного при трансляции результата.
Для этого нужно присвоить переменной \verb|g:Tex_ViewRule_pdf| имя программы просмотра. Например:
\begin{verbatim}
let g:Tex_ViewRule_pdf='zathura'
\end{verbatim}
Однако, иногда этого не достаточно, тогда нужно определить переменную \verb|g:Tex_ViewRuleComplete_pdf| 
следующим образом:
\begin{verbatim}
let g:Tex_ViewRuleComplete_pdf = 'zathura %:s?\\.tex?.pdf?'
\end{verbatim}

Существует еще одна важная команда. Это такая разновидность просмотра с функцией поиска.
Команда \texttt{<Leader>ls} открывает программу просмотра, при этом подсвечивая то место
в отображаемом документе, которое соответствует положению курсора в исходном тексте.

Кроме того, имеется и режим отладки. То есть, в специальном буфере, который называется \texttt{QuickFix list}
отображается список ошибок трансляции и возможно переходить к строкам кода, вызвавшим ошибки. 
В буфере \texttt{QuickFix list} для перемещения по списку ошибок можно использовать следующие команды
режима командной строки:
\begin{itemize}
	\item \verb|:cfirst| -- для перемещения указателя на первую ошибку в списке;
	\item \verb|:cnext| -- для перемещения на следующую ошибку;
	\item \verb|:cprev| -- для перемещения на предыдущую ошибку;
	\item \verb|:clast| -- для перемещения на последнюю ошибку в списке.
\end{itemize}
Ещё две полезнейшие команды можно искользовать в буфере \texttt{QuickFix list}. Это:
\begin{itemize}
	\item \verb|:cclose| -- для закрытия окна \texttt{QuickFix list};
	\item \verb|:copenN| -- для открытия окна высотой в N строк.
	\end{itemize}
Когда указатель в окне \texttt{QuickFix list} перемещается на выбранную ошибку, то в основном
окне редактируемого текста курсор перемещается на строку содержащую соответствующую ошибку.

Конечно, ничего описанного в этом разделе можно и не делать. Например, можно использовать
встроенный в \texttt{vim} терминал. Напомним, что для того, чтобы по вертикали разбить 
экран на две части и на половине экрана пользоваться терминалом, нужно в командном режиме
выполнить \texttt{:vert term}. Затем в открывшемся терминале выполнять команды трансляции
исходного текста и просмотра результата. 

\part{Заключение и выводы.}
В статье были рассмотрены основные возможности расширения \texttt{latexsuite}, 
предназначенного для работы с \LaTeX{} при помощи текстового редактора \texttt{VIM}.
Это далеко не исчерпывающий перечень предоставляемых расширением возможностей, но даже 
использование рассмотренных существенно помогает при создании документов. Самое главное, 
что все прелести редактора \texttt{VIM} остаются в распоряжении пользователя. 
Остается отметить, что вместе с \texttt{latexsuite} поставляется полная документация,
которая размещена в каталоге \texttt{doc}, комплекта поставки расширения, полученного
так, как описано в части~\ref{part:install}. Кроме того, документацию можно посмотреть 
в интернете по адресу https://vim-latex.sourceforge.net/documentation/latex-suite.html.
Эта документация в основном и использовалась для подготовки данной статьи. 

\end{document}

